<!doctype html>
<html ng-app="PerfApp">
<head>
  <meta charset="utf-8">
  <title>Employee Performance System</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.3/angular.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body ng-controller="MainCtrl as vm">
<nav class="navbar navbar-expand-lg navbar-dark" style="background: linear-gradient(90deg, #0062E6, #33AEFF);">

  <div class="container-fluid">
    <a class="navbar-brand d-flex align-items-center fw-bold text-white" href="#">
    <img src="static/images/logo.png" alt="Logo" width="100" height="50" class="me-2">
  </a>
    <div class="collapse navbar-collapse">
    <ul class="navbar-nav me-auto">
      <li class="nav-item" ng-if="vm.token">
        <a class="nav-link" href="" ng-click="vm.view='about'"><i class="bi bi-info-circle me-1"></i> About</a>
      </li>
      <li class="nav-item" ng-if="vm.token">
        <a class="nav-link" href="" ng-click="vm.view='dashboard'"><i class="bi bi-bar-chart-line me-1"></i> Dashboard</a>
      </li>
      <li class="nav-item" ng-if="vm.token">
        <a class="nav-link" href="" ng-click="vm.view='employees'"><i class="bi bi-people me-1"></i> Employees</a>
      </li>
      </ul>
      <div class="d-flex">
        <span ng-if="!vm.token"><button class="btn btn-outline-light me-2" ng-click="vm.view='login'">Login</button></span>
        <span ng-if="vm.token"><button class="btn btn-light" ng-click="vm.logout()">Logout</button></span>
      </div>
    </div>
  </div>
</nav>

<div class="container py-4">
  <div ng-switch="vm.view">

    <div ng-switch-when="about" class="container mt-4">
      <div class="card shadow-sm border-0 rounded-3">
        <div class="card-body">
          <h3 class="card-title mb-3">About ZeEPM</h3>
          <p>
            The <strong>Employee Performance Management System (ZeEPM)</strong> evaluates
            employee performance using a weighted scoring model. Each metric is assigned a
            percentage weight, and the final performance score is the sum of all weighted metrics.
          </p>

          <h5 class="mt-4">Performance Metrics & Weights</h5>
          <table class="table table-hover table-bordered mt-2">
            <thead class="table-light">
              <tr>
                <th>Metric</th>
                <th>Weight</th>
                <th>Measurement</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Quality of Work</td>
                <td>20%</td>
                <td>Timeliness, minimal errors, standards, innovation</td>
              </tr>
              <tr>
                <td>Dependability / Reliability</td>
                <td>10%</td>
                <td>Consistency, minimal supervision, assurance</td>
              </tr>
              <tr>
                <td>Initiative</td>
                <td>10%</td>
                <td>Motivation, research, proactive improvement</td>
              </tr>
              <tr>
                <td>Adaptability</td>
                <td>10%</td>
                <td>Flexibility, new tech learning, ambiguous tasks</td>
              </tr>
              <tr>
                <td>Compliance with Policies</td>
                <td>10%</td>
                <td>Code of conduct, confidentiality, attendance</td>
              </tr>
              <tr>
                <td>Interpersonal Relations</td>
                <td>10%</td>
                <td>Teamwork, positivity, client interactions</td>
              </tr>
              <tr>
                <td>Time Management</td>
                <td>10%</td>
                <td>Productivity, multitasking</td>
              </tr>
              <tr>
                <td>Communication Skills</td>
                <td>10%</td>
                <td>Clarity, professionalism, client-friendly</td>
              </tr>
              <tr>
                <td>Self-Improvement / Learning</td>
                <td>10%</td>
                <td>Continuous learning & skill development</td>
              </tr>
            </tbody>
          </table>

          <h5 class="mt-4">How Final Score is Calculated</h5>
          <p>
            Each metric score is multiplied by its weight, then summed to produce a
            <strong>Final Performance Score</strong> (0â€“4).
          </p>

          <div class="alert alert-info mt-3">
            <strong>Formula:</strong>  
            Final Score = Î£ (Metric Score Ã— Weight %)
          </div>

          <p class="mt-3">
            Example: If an employee scores 3/4 in Quality of Work, contribution =
            <code>3 Ã— 0.20 = 0.6</code>. The same is applied to all metrics, and the total
            is the employeeâ€™s performance score.
          </p>
        </div>
      </div>
    </div>


    <div ng-switch-when="login" class="d-flex justify-content-center align-items-center" style="min-height:70vh;">
      <div class="card shadow-sm p-4" style="max-width: 360px; width:100%; border-radius: 1rem;">
        <h4 class="text-center mb-3">ðŸ”‘ Login</h4>
        <form ng-submit="vm.login()">
          <div class="form-floating mb-3">
            <input type="email" class="form-control" id="loginEmail" placeholder="name@example.com" ng-model="vm.loginForm.email" required>
            <label for="loginEmail">Email</label>
          </div>
          <div class="form-floating mb-3">
            <input type="password" class="form-control" id="loginPassword" placeholder="Password" ng-model="vm.loginForm.password" required>
            <label for="loginPassword">Password</label>
          </div>
          <button class="btn btn-primary w-100 rounded-pill">Login</button>
          <div class="mt-3 text-danger small text-center" ng-if="vm.loginError">{{vm.loginError}}</div>
        </form>
      </div>
    </div>


    <div ng-switch-when="employees" class="container py-4">

      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold text-secondary">Employee Directory</h3>
        <div>
          <input type="text" class="form-control d-inline-block me-2" 
                 style="width: 250px;" placeholder="ðŸ” Search employee..."
                 ng-model="vm.searchText">
        </div>
      </div>

      <!-- Employee Grid -->
      <div class="row g-4">
        <div class="col-md-6 col-lg-4" 
             ng-repeat="e in vm.employees | filter:vm.searchText">

          <div class="card border-0 shadow-lg rounded-4 h-100 hover-card">
            <div class="card-body text-center d-flex flex-column">

              <!-- Avatar -->
              <div class="avatar-circle mx-auto mb-3">
                <i class="bi bi-person-fill fs-1 text-white"></i>
              </div>

              <!-- Employee Info -->
              <h5 class="fw-bold mb-1">{{e.name}}</h5>
              <span class="badge bg-info text-white px-3 py-2 mb-2">
                {{e.designation}}
              </span>
              <p class="text-muted small mb-2">
                <i class="bi bi-envelope me-1"></i>{{e.email}}
              </p>

              <!-- Actions -->
              <div class="d-flex justify-content-center mt-auto gap-2">
                <button class="btn btn-sm btn-outline-primary px-3" 
                        ng-click="vm.viewEmployee(e)">
                  <i class="bi bi-eye me-1"></i> View Performance Report
                </button>
<!--                 <button class="btn btn-sm btn-outline-danger px-3" 
                        ng-click="vm.deleteEmployee(e)">
                  <i class="bi bi-trash me-1"></i> Delete
                </button>
 -->              </div>
            </div>
          </div>

        </div>
      </div>
    </div>




    <div ng-switch-when="dashboard">
      <div ng-if="vm.role==='admin'" class="my-4">
        <div class="card shadow-sm border-0 rounded-3">
          <div class="card-header d-flex justify-content-between align-items-center bg-light">
            <h5 class="mb-0">ðŸ‘¥ Team Ranking</h5>
            <button class="btn btn-sm btn-outline-primary" ng-click="vm.fetchTeam()">
              <i class="bi bi-arrow-clockwise"></i> Refresh
            </button>
          </div>
          <div class="card-body p-3" ng-if="vm.team.length">
            <div class="table-responsive">
              <table class="table table-hover align-middle">
                <thead class="table-light">
                  <tr>
                    <th scope="col">#</th>
                    <th scope="col">Employee</th>
                    <th scope="col">Final Score</th>
                  </tr>
                </thead>
                <tbody>
                  <tr ng-repeat="t in vm.team track by $index">
                    <td>{{$index + 1}}</td>
                    <td>{{t.name}}</td>
                    <td><span class="badge bg-success">{{t.final_score | number:2}}</span></td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="card-body text-muted text-center" ng-if="!vm.team.length">
            <em>No team data available</em>
          </div>
        </div>
      </div>

      <div ng-if="vm.role==='manager'">
        <div class="row mb-4">
          <!-- Subordinate Dropdown -->
          <div class="col-md-6">
            <h6 class="fw-bold">My Reportee</h6>
            <select class="form-select" ng-model="vm.selectedEmp" 
                    ng-change="vm.loadMetrics(vm.selectedEmp)">
              <option ng-repeat="e in vm.employees" ng-value="e.id">{{e.name}}</option>
            </select>
          </div>

          <!-- Month Dropdown -->
          <div class="col-md-6">
            <h6 class="fw-bold">Select Month</h6>
            <select class="form-select" ng-model="vm.selectedMonth"
                    ng-change="vm.loadMetrics(vm.selectedEmp, vm.selectedMonth)">
              <option value="">-- All Months --</option>
              <option ng-repeat="month in vm.availableMonths" value="{{month}}">
                {{ month }}
              </option>
            </select>
          </div>
        </div>
          <div class="mt-4" ng-if="vm.chartData">
            <div class="card border-0 shadow-lg rounded-3">
              <!-- Chart Header -->
              <div class="card-header bg-gradient bg-info text-white d-flex align-items-center">
                <i class="bi bi-graph-up me-2"></i>
                <h5 class="mb-0">Performance Metrics Overview</h5>
              </div>

              <!-- Chart Body -->
              <div class="card-body">
                <div class="chart-container" style="position: relative; height:400px; width:100%">
                  <canvas id="metricChart"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="mt-4">
            <div class="card border-0 shadow-lg rounded-3">
              <!-- Header -->
              <div class="card-header bg-gradient bg-primary text-white d-flex align-items-center">
                <i class="bi bi-clipboard-check me-2"></i>
                <h5 class="mb-0">Add Employee Performance Metrics</h5>
              </div>

              <!-- Body -->
              <div class="card-body bg-light">
                <form ng-submit="vm.addAllMetrics(vm.selectedEmp)">
                  <div class="table-responsive">
                    <table class="table table-sm table-hover align-middle mb-0">
                      <thead class="table-primary">
                        <tr>
                          <th style="width:20%">Metric</th>
                          <th style="width:10%" class="text-center">Score (0â€“4)</th>
                          <th style="width:70%">Comments</th>
                        </tr>
                      </thead>
                      <tbody>
                        <tr ng-repeat="metric in vm.metricsList" class="align-middle">
                          <!-- Metric Label -->
                          <td class="fw-semibold">{{metric.label}}</td>

                          <!-- Score -->
                          <td>
                            <input type="number"
                                   class="form-control form-control-sm text-center"
                                   ng-model="metric.score" min="0" max="4"
                                   placeholder="0-4" required>
                          </td>

                          <!-- Comment -->
                          <td>
                            <textarea class="form-control form-control-sm"
                                      style="min-width: 100%;"
                                      rows="2"
                                      ng-model="metric.comment"
                                      placeholder="Add detailed notes..."></textarea>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>

                  <!-- Save Button -->
                  <div class="mt-3 text-end">
                    <button class="btn btn-success btn-lg px-4 shadow-sm">
                      <i class="bi bi-save me-1"></i> Save Metrics
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>


    </div>

    <div ng-switch-default>
      <h3>Welcome</h3>
      <p>Use the navigation to login and explore the app.</p>
    </div>

  </div>
</div>

<script src="app.js"></script>
</body>
</html>
